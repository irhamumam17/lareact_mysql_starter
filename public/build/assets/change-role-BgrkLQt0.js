import{b as C,a as t,h as p,j as e,r as j}from"./app-C_bXf2sr.js";import{B as D}from"./badge-BiPyi1_y.js";import{B as R}from"./button-DHoFMfdx.js";import{e as A,d as w,D as B,b as E,a as k,X as z,c as I}from"./dialog-DH-eE5NM.js";import{d as L,S as M,a as T,c as V,b as F}from"./select-Ek57nmN1.js";import{r as H}from"./index-BoBIKhFC.js";import{u as v}from"./index-ktf0LBql.js";/* empty css            */import"./index-tePfFT3D.js";import"./utils-D0Zg16Wk.js";import"./index-Dm0sKS8Q.js";import"./index-RfGvqZ94.js";import"./index-BRWa5CH2.js";import"./createLucideIcon-BqDcP8VQ.js";import"./index-s7Ef9wOL.js";import"./index-dN7Orpqu.js";import"./index-DF-2G2Mf.js";import"./index-C5AjprLp.js";import"./check-DvKWxHKb.js";import"./index-CMWG4mbA.js";function oe({user:l,open:r,onOpenChange:u}){const{auth:h}=C().props,[f,S]=t.useState([]),[d,g]=t.useState(!1),[o,i]=t.useState(!1),[n,c]=t.useState(l.roles??h.roles??[]);t.useEffect(()=>{r&&c(l.roles??h.roles??[])},[r,l.id]),t.useEffect(()=>{if(!r)return;g(!0);const{url:s}=H.index.get();p.get(s,{headers:{Accept:"application/json"}}).then(a=>S(a.data)).finally(()=>g(!1))},[r]);const m=t.useMemo(()=>{const s=new Set(n.map(a=>a.id));return f.filter(a=>!s.has(a.id))},[f,n]);async function b(s){if(!o)try{i(!0);const{url:a}=v.assignRole.post(l.id),x=(await p.post(a,{role_id:s},{headers:{Accept:"application/json"}})).data.roles??[];c(x),j.reload({only:["users"]})}finally{i(!1)}}async function N(s){if(!o)try{i(!0);const{url:a}=v.removeRole.delete({user:l.id,role:s.id}),x=(await p.delete(a,{headers:{Accept:"application/json"}})).data.roles??[];c(x),j.reload({only:["users"]})}finally{i(!1)}}return e.jsx(A,{open:r,onOpenChange:u,children:e.jsxs(w,{children:[e.jsxs(B,{children:[e.jsx(E,{children:"Change Role"}),e.jsxs(k,{children:["Manage roles for user ",e.jsx("b",{children:l.name})]})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-sm font-medium",children:"Current roles"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.length===0&&e.jsx("span",{className:"text-muted-foreground text-sm",children:"No roles assigned"}),n.map(s=>e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(D,{children:s.name}),e.jsx(R,{size:"sm",variant:"ghost",className:"h-6 px-1",disabled:o,onClick:()=>N(s),"aria-label":`Remove ${s.name}`,children:e.jsx(z,{className:"size-3"})})]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-sm font-medium",children:"Add role"}),e.jsxs(L,{disabled:d||o||m.length===0,onValueChange:s=>b(Number(s)),children:[e.jsx(M,{"aria-label":"Select role to add",children:e.jsx(T,{placeholder:d?"Loading roles...":"Select role"})}),e.jsx(V,{children:m.map(s=>e.jsx(F,{value:String(s.id),children:s.name},s.id))})]}),m.length===0&&!d&&e.jsx("div",{className:"mt-1 text-muted-foreground text-xs",children:"All roles have been added"})]})]}),e.jsx(I,{children:e.jsx(R,{onClick:()=>u(!1),variant:"outline",children:"Close"})})]})})}export{oe as default};
